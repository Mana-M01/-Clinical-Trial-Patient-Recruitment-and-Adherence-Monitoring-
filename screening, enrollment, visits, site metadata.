#1.Create anonymized sample CSVs for screening, enrollment, visits, site metadata.
import pandas as pd
import numpy as np

# ----------------------------
# 1️⃣ Sample Site Metadata
# ----------------------------
site_metadata = pd.DataFrame({
    "Site ID": [f"S{i:03d}" for i in range(1, 6)],
    "Site Name": [f"Site {i}" for i in range(1, 6)],
    "Country": ["USA", "UK", "India", "Germany", "Canada"],
    "PI Name": [f"Dr. {n}" for n in ["Smith", "Jones", "Kumar", "Müller", "Brown"]]
})
site_metadata.to_csv("site_metadata.csv", index=False)

# ----------------------------
# 2️⃣ Sample Screening CSV
# ----------------------------
n_patients = 20
screening = pd.DataFrame({
    "Patient ID": [f"P{i:03d}" for i in range(1, n_patients+1)],
    "Site ID": np.random.choice(site_metadata["Site ID"], n_patients),
    "Screening Date": pd.date_range(start="2025-01-01", periods=n_patients, freq="3D"),
    "Age": np.random.randint(18, 65, n_patients),
    "Gender": np.random.choice(["Male", "Female"], n_patients),
    "Screening Outcome": np.random.choice(["Eligible", "Ineligible"], n_patients, p=[0.8, 0.2])
})
screening.to_csv("screening.csv", index=False)

# ----------------------------
# 3️⃣ Sample Enrollment CSV
# ----------------------------
enrolled = screening[screening["Screening Outcome"] == "Eligible"].copy()
enrolled["Enrollment Date"] = enrolled["Screening Date"] + pd.to_timedelta(np.random.randint(1, 14, len(enrolled)), unit="D")
enrolled["Randomized"] = np.random.choice(["Yes", "No"], len(enrolled), p=[0.9, 0.1])
enrolled.to_csv("enrollment.csv", index=False)

# ----------------------------
# 4️⃣ Sample Visits CSV
# ----------------------------
visits = []
for idx, row in enrolled.iterrows():
    n_visits = np.random.randint(2, 5)  # number of visits per patient
    for v in range(1, n_visits+1):
        visits.append({
            "Patient ID": row["Patient ID"],
            "Visit Number": v,
            "Visit Date": row["Enrollment Date"] + pd.to_timedelta(v*7, unit="D"),
            "Adverse Event": np.random.choice(["None", "Mild", "Severe"], p=[0.7, 0.25, 0.05])
        })
visits_df = pd.DataFrame(visits)
visits_df.to_csv("visits.csv", index=False)

# ----------------------------
# ✅ Output Overview
# ----------------------------
print("Site Metadata:\n", site_metadata.head(), "\n")
print("Screening:\n", screening.head(), "\n")
print("Enrollment:\n", enrolled.head(), "\n")
print("Visits:\n", visits_df.head())
